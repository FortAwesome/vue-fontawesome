name: CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        free-solid-svg-icons: [
          5.x,
          6.x
        ]
        fontawesome-svg-core: [
          1.2.x,
          6.x
        ]
        node-version: [
          14.x,
          16.x,
          18.x
        ]
        vue: [
          2.4.x,
          2.5.x,
          2.6.x,
          2.7.x
        ]

    steps:
    - uses: actions/checkout@v1
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v1
      with:
        node-version: ${{ matrix.node-version }}
    - name: v5 install, build, and test
      run: |
        npm install -g npm
        npm install
        if [[ ${{ matrix.free-solid-svg-icons }} == '5.x' ]]; then
          npm install --no-save @fortawesome/fontawesome-svg-core@1.2.x @fortawesome/free-solid-svg-icons@5.x vue@${{ matrix.vue }}
        else
          npm install --no-save @fortawesome/fontawesome-svg-core@6.x @fortawesome/free-solid-svg-icons@5.x vue@${{ matrix.vue }}
        fi
        npm run build
        npm list vue
        npm run test
      env:
        CI: true
        FONTAWESOME_NPM_AUTH_TOKEN: ${{ secrets.FONTAWESOME_NPM_AUTH_TOKEN }}
    - name: dist
      run: |
        npm run dist
